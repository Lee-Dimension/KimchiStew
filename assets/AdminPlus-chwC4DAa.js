import{r as c,o as I,c as F,a as g,b as w,d as n,e as M,f as B,g as L,h as A,l as C,F as S,j,n as E,t as T}from"./index-CKOF-s42.js";const J={class:"background-out"},V={class:"background-in"},H={class:"head-setting mb-5"},U={class:"flex flex-col items-center"},z={class:"flex flex-col mt-4 w-70"},G={class:"flex flex-col w-full mb-4"},q={class:"flex flex-col w-full"},K={class:"grid grid-cols-2 gap-4 mt-10 mb-5"},Q={class:"input-box rounded-lg p-4 w-35 h-50 overflow-y-auto"},W=["onClick"],X={class:"input-box rounded-lg p-4 w-35 h-50 overflow-y-auto"},Y=["onClick"],te={__name:"AdminPlus",setup(Z){const s=c([]),k=c(!1),D=c(!1),u=c(null),i=c(null),p=c(null),r=c(null),d=c(""),b=c(""),m=c(!1);I(async()=>{k.value=!0,D.value=!1;try{const a=await fetch("http://localhost:8080/api/locations",{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!a.ok)throw new Error(`HTTP ${a.status}`);const e=await a.json();s.value=Array.isArray(e)?e:[]}catch{D.value=!0,s.value=[]}finally{k.value=!1}});const _=F(()=>s.value.map(a=>({id:a.id,name:a.name}))),R=F(()=>s.value.find(e=>e.id===i.value)?.sites??[]),N=async()=>{if(i.value&&r.value){if(!confirm("현장을 지울 시 해당되는 현장근로자와 현장 정보가 지워집니다."))return;try{const e=await fetch(`http://localhost:8080/api/site/${r.value}`,{method:"DELETE",headers:{Accept:"application/json"},credentials:"include"});if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=s.value.find(l=>l.id===i.value);if(t&&Array.isArray(t.sites)){const l=t.sites.findIndex(o=>o.id===r.value);l!==-1&&t.sites.splice(l,1)}r.value=null,p.value=null,alert("현장이 삭제되었습니다.")}catch{alert("현장 삭제에 실패했습니다. 잠시 후 다시 시도해주세요.")}return}if(i.value&&!r.value){if(!confirm("지역을 지울 시 해당되는 현장과 근로자 현장 정보도 전부 지워집니다."))return;try{const e=await fetch(`http://localhost:8080/api/region/${i.value}`,{method:"DELETE",headers:{Accept:"application/json"},credentials:"include"});if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=s.value.findIndex(l=>l.id===i.value);t!==-1&&s.value.splice(t,1),i.value=null,u.value=null,r.value=null,p.value=null,d.value="",alert("지역이 삭제되었습니다.")}catch{alert("지역 삭제에 실패했습니다. 잠시 후 다시 시도해주세요.")}return}alert("삭제할 지역 또는 현장을 선택해주세요.")},$=async()=>{if(m.value)return;const a=(d.value||"").trim(),e=(b.value||"").trim();if(a&&e){try{m.value=!0;let t=s.value.find(h=>h.name===a),l=!1;if(!t){const h=await fetch("http://localhost:8080/api/locations",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({name:a})});if(!h.ok)throw new Error("지역 추가 실패");const y=await h.json();t={id:y.id??Date.now(),name:y.name,sites:y.sites??[]},s.value.push(t),l=!0}const o=t.id,f=await fetch(`http://localhost:8080/api/locations/${o}/sites`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({name:e})});if(!f.ok)throw new Error("현장 추가 실패");const v=await f.json(),x=s.value.find(h=>h.id===o);x&&(x.sites=x.sites||[],x.sites.push({id:v.id??Date.now(),name:v.name??e})),u.value=t.name,p.value=v.name??e,d.value=t.name,b.value="",alert(l?"지역과 현장이 추가되었습니다.":"현장이 추가되었습니다.")}catch{alert("지역/현장 동시 추가에 실패했습니다. 잠시 후 다시 시도해주세요.")}finally{m.value=!1}return}if(a&&!e){try{m.value=!0;const t=s.value.find(f=>f.name===a);if(t){u.value=t.name,d.value=t.name,alert("이미 존재하는 지역입니다. 해당 지역을 선택했습니다.");return}const l=await fetch("http://localhost:8080/api/locations",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({name:a})});if(!l.ok)throw new Error("지역 추가 실패");const o=await l.json();s.value.push({id:o.id??Date.now(),name:o.name,sites:o.sites??[]}),u.value=o.name,d.value=o.name,alert("지역이 추가되었습니다.")}catch{alert("지역 추가에 실패했습니다. 잠시 후 다시 시도해주세요.")}finally{m.value=!1}return}if(e&&!u.value&&!a){alert("현장만 추가할 수 없습니다. 먼저 지역을 선택하거나 생성하세요.");return}if(e){try{m.value=!0;let t=null;if(u.value&&(t=s.value.find(v=>v.name===u.value)),!t&&a&&(t=s.value.find(v=>v.name===a),t&&(u.value=t.name)),!t){alert("선택/입력한 지역을 찾을 수 없습니다. 먼저 지역을 추가하세요.");return}const l=await fetch(`http://localhost:8080/api/locations/${t.id}/sites`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({name:e})});if(!l.ok)throw new Error("현장 추가 실패");const o=await l.json(),f=s.value.find(v=>v.id===t.id);f&&(f.sites=f.sites||[],f.sites.push({id:o.id??Date.now(),name:o.name??e})),p.value=o.name??e,alert("현장이 추가되었습니다."),b.value=""}catch{alert("현장 추가에 실패했습니다. 잠시 후 다시 시도해주세요.")}finally{m.value=!1}return}alert("추가할 지역 또는 현장 이름을 입력해주세요.")},O=a=>{i.value===a.id?(i.value=null,u.value=null,d.value=""):(i.value=a.id,u.value=a.name,d.value=a.name),r.value=null,p.value=null},P=a=>{r.value===a.id?(r.value=null,p.value=null):(r.value=a.id,p.value=a.name)};return(a,e)=>{const t=L("router-link");return w(),g("div",J,[n("div",V,[n("header",H,[M(t,{to:"/admin",class:"heed-text"},{default:B(()=>[...e[2]||(e[2]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2.5",stroke:"#78711D",class:"w-6 h-6"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})],-1)])]),_:1}),e[3]||(e[3]=n("h1",{class:"text-3xl font-bold text-[#78711D]"},"현장 등록",-1)),e[4]||(e[4]=n("p",null,null,-1))]),n("main",U,[n("form",z,[n("div",G,[e[5]||(e[5]=n("label",{for:"region",class:"input-label"},"지역",-1)),A(n("input",{type:"text",id:"region","onUpdate:modelValue":e[0]||(e[0]=l=>d.value=l),placeholder:"서울",class:"input-box"},null,512),[[C,d.value]])]),n("div",q,[e[6]||(e[6]=n("label",{for:"site",class:"input-label"},"현장",-1)),A(n("input",{type:"text",id:"site","onUpdate:modelValue":e[1]||(e[1]=l=>b.value=l),placeholder:"트리마제",class:"input-box"},null,512),[[C,b.value]])])]),n("div",K,[n("div",Q,[e[7]||(e[7]=n("h2",{class:"text-xl font-bold text-[#78711D] mb-2 text-center"},"지역",-1)),(w(!0),g(S,null,j(_.value,l=>(w(),g("div",{key:l.id??l.name,onClick:o=>O(l),class:E(["p-2 mb-2 rounded-md cursor-pointer text-center border border-[#DCD7B8] bg-[#FFFDE3]",i.value===l.id?"bg-[#78711D] text-[#3A9CFF] border-[#3A9CFF]":"bg-gray-100 text-[#1D1A05] hover:bg-[#FFFDE3]"])},T(l.name),11,W))),128))]),n("div",X,[e[8]||(e[8]=n("h2",{class:"text-xl font-bold text-[#78711D] mb-2 text-center"},"현장",-1)),(w(!0),g(S,null,j(R.value,l=>(w(),g("div",{key:l.id??l.name,onClick:o=>P(l),class:E(["p-2 mb-2 rounded-md cursor-pointer text-center border border-[#DCD7B8] bg-[#FFFDE3]",r.value===l.id?"bg-[#78711D] text-[#3A9CFF] border-[#3A9CFF]":"bg-gray-100 text-[#1D1A05] hover:bg-[#FFFDE3]"])},T(l.name),11,Y))),128))])])]),n("footer",{class:"flex justify-center py-4 gap-4"},[n("button",{type:"button",onClick:N,class:"bg-white text-red-500 text-sm font-bold py-3 px-6 rounded-full border border-red-500"},"현장 삭제하기"),n("button",{type:"button",onClick:$,class:"bg-black text-[#3A9CFF] text-sm font-bold py-3 px-6 rounded-full"},"현장 추가하기")])])])}}};export{te as default};
