import{_ as E,r as i,o as j,c as T,a as r,b as d,d as o,e as $,f as N,g as D,F as b,j as w,n as v,t as p}from"./index-CKOF-s42.js";const R={class:"background-out"},U={class:"background-in"},B={class:"head-setting mb-10"},I={class:"flex-grow flex flex-col space-y-3"},H={class:"brown-box flex-grow flex-col p-2 h-40"},P={class:"grid grid-cols-3 gap-2 overflow-y-auto flex-grow"},L=["onClick"],G={class:"brown-box flex-grow flex-col p-6 h-60"},M={class:"text-xl font-bold text-[#FFEC17] mb-4 text-center"},S={class:"overflow-y-auto flex-grow"},V=["onClick"],q={class:"mr-10"},z={key:1,class:"text-white text-center"},J={class:"flex justify-center py-4"},O=["disabled"],W={__name:"AdminEditList",setup(K){const m=i([]),c=i([]),_=i(!1),h=i(!1),x=i(null),f=i(null),n=i(null),g=async()=>{_.value=!0;try{const e=await fetch("http://localhost:8080/api/locations",{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!e.ok)throw new Error(`HTTP ${e.status}`);const s=await e.json();m.value=Array.isArray(s)?s.map(t=>typeof t=="string"?{id:t,name:t}:{id:t.id??t.value??t.regionId??t.region_id??t.regionName??t.name,name:t.name??t.regionName??t.value??""}):[]}finally{_.value=!1}},k=async(e,s)=>{if(!e&&!s){c.value=[];return}h.value=!0;try{let t="";e&&typeof e=="number"?t=`regionId=${encodeURIComponent(e)}`:e&&typeof e=="string"&&!s?t=`regionName=${encodeURIComponent(e)}`:s&&(t=`regionName=${encodeURIComponent(s)}`);const a=await fetch(`http://localhost:8080/api/users?${t}`,{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!a.ok)throw new Error(`HTTP ${a.status}`);const u=await a.json();c.value=Array.isArray(u)?u.map(l=>({id:l.id,name:l.name,regionId:l.regionId??l.region_id??null,regionName:l.regionName??l.region??l.region_name??null,siteId:l.siteId??l.site_id??null,site:l.siteName??l.site??l.site_name??"-"})):[]}catch{c.value=[]}finally{h.value=!1}};j(async()=>{await g()});const C=async e=>{const s=e.id??e.value,t=e.name??e.value??e.regionName??"";x.value=s,f.value=t,n.value=null,await k(s,t)},A=e=>{n.value=e},y=T(()=>c.value),F=async()=>{if(!n.value){alert("삭제할 작업자를 선택해주세요.");return}try{const e=await fetch(`http://localhost:8080/api/users/${n.value.id}`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({region_id:null,site_id:null})});if(!e.ok)throw new Error(`HTTP ${e.status}`);c.value=c.value.filter(s=>s.id!==n.value.id),n.value=null,alert("작업자의 작업 위치 정보가 삭제되었습니다.")}catch{alert("작업자 삭제 처리에 실패했습니다. 잠시 후 다시 시도해주세요.")}};return(e,s)=>{const t=D("router-link");return d(),r("div",R,[o("div",U,[o("header",B,[$(t,{to:"/admin",class:"heed-text"},{default:N(()=>[...s[0]||(s[0]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2.5",stroke:"#78711D",class:"w-6 h-6"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})],-1)])]),_:1}),s[1]||(s[1]=o("h1",{class:"text-3xl font-bold text-[#78711D]"},"명단 관리",-1)),s[2]||(s[2]=o("p",null,null,-1))]),o("main",I,[o("div",H,[s[3]||(s[3]=o("h2",{class:"text-xl font-bold text-[#FFEC17] pt-2 mb-4 text-center"},"지역 선택",-1)),o("div",P,[(d(!0),r(b,null,w(m.value,a=>(d(),r("div",{key:a.id??a.value,onClick:u=>C(a),class:v(["p-2 rounded-md cursor-pointer text-center h-15 w-20 flex items-center justify-center border",x.value===(a.id??a.value)?"bg-black text-[#3A9CFF] border-[#3A9CFF]":"bg-gray-100 text-[#1D1A05] hover:bg-[#FFFDE3] border-[#DCD7B8]"])},p(a.name),11,L))),128))])]),o("div",G,[o("h2",M,p(f.value?f.value+" 현장 명단":"현장 명단"),1),o("div",S,[y.value.length>0?(d(!0),r(b,{key:0},w(y.value,a=>(d(),r("div",{key:a.id,onClick:u=>A(a),class:v(["button-click",n.value&&n.value.id===a.id?"button-click-before":"button-click-after"])},[o("p",q,"현장: "+p(a.site),1),o("p",null,"이름: "+p(a.name),1)],10,V))),128)):(d(),r("p",z,"선택된 지역의 명단이 없습니다."))])])]),o("footer",J,[o("button",{type:"button",onClick:F,class:v(["bg-black text-blue-500 font-bold py-3 px-6 rounded-xl w-full",n.value?"":"opacity-50 cursor-not-allowed"]),disabled:!n.value},"작업자 삭제",10,O)])])])}}},X=E(W,[["__scopeId","data-v-2ce1020f"]]);export{X as default};
