import{r as i,o as T,c as x,w as C,a as o,b as a,d as t,e as E,f as N,g as U,h as f,i as A,v as g,F as h,j as y,k as B,l as _,n as F,u as M,m as D,t as w}from"./index-CKOF-s42.js";import{_ as L}from"./doldari-Da9TNeQ0.js";const O={class:"background-out"},I={class:"background-in"},J={class:"head-setting"},P={class:"main-setting"},z={class:"flex justify-center gap-4 w-full px-5 mb-3"},G={class:"flex flex-col items-center flex-1"},H=["value"],R={key:0,class:"text-gray-400 mt-1"},$={key:1,class:"text-red-500 mt-1"},q={class:"flex flex-col items-center flex-1"},K=["disabled"],Q=["value"],W={class:"flex flex-col items-center"},X={class:"flex flex-col w-full mb-4"},Y={class:"flex flex-col w-full mb-4"},Z={key:0,class:"text-red-500 text-center mb-5"},ee={key:1,class:"mb-5"},te=["disabled"],ae={__name:"Login",setup(le){const k=M(),n=i(""),u=i(""),r=i(""),d=i(""),v=i(!1),c=i([]),b=i(!1),m=i(!1);T(async()=>{b.value=!0,m.value=!1;try{const s=await fetch("http://localhost:8080/api/locations",{method:"GET",headers:{Accept:"application/json"}});if(!s.ok)throw new Error(`HTTP ${s.status}`);const e=await s.json();Array.isArray(e)&&e.length>0?c.value=e:(c.value=[],m.value=!0)}catch{c.value=[],m.value=!0}finally{b.value=!1}});const S=x(()=>c.value.find(e=>e.name===n.value)?.sites??[]);C(n,()=>{u.value=""});const p=x(()=>!n.value||!u.value||!r.value||!d.value),V=async()=>{if(!p.value){v.value=!1;try{const s=await fetch("http://localhost:8080/api/user/login",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({region:n.value,site:u.value,name:r.value,phone:d.value})});if(!s.ok){v.value=!0;return}const e=await s.json().catch(()=>({}));sessionStorage.setItem("loggedInUser",JSON.stringify(e||{region:n.value,site:u.value,name:r.value,phone:d.value})),k.push("/main")}catch{v.value=!0}}};return(s,e)=>{const j=U("router-link");return a(),o("div",O,[t("div",I,[t("div",J,[e[5]||(e[5]=t("p",null,null,-1)),E(j,{to:"/adminlogin",class:"heed-text"},{default:N(()=>[...e[4]||(e[4]=[D("관리자 로그인",-1)])]),_:1})]),t("main",P,[e[12]||(e[12]=t("img",{src:L,class:"w-50 h-50"},null,-1)),t("div",z,[t("div",G,[e[7]||(e[7]=t("label",{for:"region",class:"mb-2 font-bold text-[#767676] w-25 text-left"},"지역",-1)),f(t("select",{id:"region","onUpdate:modelValue":e[0]||(e[0]=l=>n.value=l),class:"p-1 border-b w-25 text-[#767676]"},[e[6]||(e[6]=t("option",{disabled:"",value:""},"지역 선택",-1)),(a(!0),o(h,null,y(c.value,l=>(a(),o("option",{key:l.id??l.name,value:l.name},w(l.name),9,H))),128))],512),[[g,n.value]]),b.value?(a(),o("small",R,"지역 불러오는 중...")):m.value?(a(),o("small",$,"지역 목록을 불러오지 못했습니다.")):A("",!0)]),t("div",q,[e[9]||(e[9]=t("label",{for:"site",class:"mb-2 font-bold text-[#767676] w-25 text-left"},"현장",-1)),f(t("select",{id:"site","onUpdate:modelValue":e[1]||(e[1]=l=>u.value=l),class:"p-1 border-b w-25 text-[#767676]",disabled:!n.value},[e[8]||(e[8]=t("option",{disabled:"",value:""},"현장 선택",-1)),(a(!0),o(h,null,y(S.value,l=>(a(),o("option",{key:l.id??l.name,value:l.name},w(l.name),9,Q))),128))],8,K),[[g,u.value]])])]),t("div",W,[t("form",{onSubmit:B(V,["prevent"]),class:"flex flex-col mt-4 w-70"},[t("div",X,[e[10]||(e[10]=t("label",{for:"name",class:"input-label"},"이름",-1)),f(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>r.value=l),type:"text",id:"name",placeholder:"홍길동",class:"input-box"},null,512),[[_,r.value]])]),t("div",Y,[e[11]||(e[11]=t("label",{for:"phone",class:"input-label"},"전화번호",-1)),f(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>d.value=l),type:"tel",id:"phone",placeholder:"01012341234",class:"input-box"},null,512),[[_,d.value]])]),v.value?(a(),o("p",Z,"입력하신 정보가 일치하지 않습니다")):(a(),o("div",ee)),t("button",{type:"submit",disabled:p.value,class:F([{"bg-gray-300":p.value,"bg-[#FFEC17] hover:bg-yellow-300":!p.value},"login-button"])},"로그인",10,te)],32)])])])])}}};export{ae as default};
